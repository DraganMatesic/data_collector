[← Back to index](1.%20index.md)

# Roadmap

## Methodology

This project uses **Kanban** with well-defined work packages. Each work package has clear "done" criteria, depends only on completed packages, and can be pulled when ready. There are no time-boxed sprints — work packages are completed sequentially with a strict WIP limit of one.

**Board structure:**

| Column | WIP Limit | Description |
|--------|-----------|-------------|
| Backlog | — | Defined work packages not yet started |
| In Progress | 1 | Currently being implemented |
| Review | 2 | Code complete, running tests and updating docs |
| Done | — | Shipped, tested, documented |

**Rules:**
- Pull the next work package only when the current one reaches "Done"
- Every work package includes unit tests and documentation updates
- Work packages can be split if scope grows (e.g., WP-12 → WP-12a/12b/12c)

---

## Milestone Overview

| Version | Milestone | Work Packages | Status |
|---------|-----------|---------------|--------|
| v0.1.0 | Core Framework | — (complete) | **Current** |
| v0.2.0 | Core Application Infrastructure | WP-01, WP-02, WP-03 | Planned |
| v0.3.0 | Scraping & Collection | WP-04, WP-05, WP-06 | Planned |
| v0.4.0 | Messaging & Orchestration | WP-07, WP-08, WP-09 | Planned |
| v0.5.0 | Pipeline & Integration | WP-10, WP-11, WP-12 | Planned |
| v0.6.0 | Advanced Features | WP-13 | Planned |
| v1.0.0 | Platform Release | WP-14, WP-15 | Planned |

---

## Dependency Graph

```
Enums ──────────────────────────────────┐
Request + RequestMetrics ───────────────┤
@fun_watch + AppFunctions ──────────────┤
                                        ├──→ BaseScraper + scaffold CLI
Proxy (ProxyProvider, Reservation) ─────┤
Captcha (AntiCaptcha) ──────────────────┘

Notifications (pluggable channels) ─────┐
RabbitMQ (pika, command channel) ───────┤
                                        ├──→ Manager + Scheduler
Enums (CmdName, CmdFlag) ──────────────┘

RabbitMQ ──────────────────────────────→ Dramatiq + TaskDispatcher
WatchService ──────────────────────────→ Events table → TaskDispatcher
PDF/OCR + Dramatiq ────────────────────→ NER pipeline
Everything ────────────────────────────→ REST API + Dashboard
```

All dependencies flow forward — no work package depends on a later work package.

---

## v0.1.0 — Core Framework (DONE)

The foundation layer. Everything else builds on this.

| Component | Status | Description |
|-----------|--------|-------------|
| Database abstraction | Done | `Database` class with PostgreSQL, MSSQL connectors (pluggable `BaseDBConnector` for future additions) |
| Settings management | Done | Pydantic-based `DatabaseSettings`, `LogSettings`, `GeneralSettings` |
| SHA-based merge | Done | `make_hash()`, `bulk_hash()`, `obj_diff()`, `SHAHashableMixin` |
| ORM models | Done | `Apps`, `AppGroups`, `AppParents`, `AppDbObjects`, `Runtime`, `Logs` |
| Table deployment | Done | `Deploy` class with create/drop/seed operations |
| Structured logging | Done | `LoggingService` with structlog frontend, `DatabaseHandler`, `SplunkHECHandler`, `RouterHandler` (fallback file logging), `context_json` for arbitrary structured context |
| Secret management | Done | `SecretLoader` with AES-256-CBC encryption |
| Object dependency tracking | Done | Automatic `AppDbObjects` population during CRUD operations |
| Documentation validator | Done | `validate_docs.py` with CI enforcement |
| Test infrastructure | Done | pytest with unit/quality/integration layers, CI workflows |

---

## v0.2.0 — Core Application Infrastructure

Building blocks that all application-layer features depend on.

### WP-01: Enums Package

Create the shared enum definitions used across the framework.

| Deliverable | Description |
|-------------|-------------|
| Planned module path: `data_collector/enums/commands.py` | `CmdName` (START/STOP/RESTART/ENABLE/DISABLE), `CmdFlag` (IDLE/PENDING/DONE), `RunStatus`, `FatalFlag` |
| Planned module path: `data_collector/enums/database.py` | `DbObjectType` (TABLE/VIEW/PROCEDURE/FUNCTION/SCHEMA/INDEX) |
| Planned module path: `data_collector/enums/hashing.py` | `UnicodeForm` (NFC/NFKC/NFD/NFKD/NONE) |
| Planned module path: `data_collector/enums/notifications.py` | `AlertSeverity` (INFO/WARNING/ERROR/CRITICAL) |
| Refactoring | Move hardcoded values from existing code into enum imports |

**Done when:** All enums importable, existing code uses enum classes, tests pass.
**Depends on:** Nothing.

### WP-02: Request Class + RequestMetrics

Centralized HTTP client used by scrapers, proxy judges, CAPTCHA solvers, SOAP calls, and notifications.

| Deliverable | Description |
|-------------|-------------|
| Planned module path: `data_collector/utilities/request.py` | httpx-based sync + async HTTP client |
| Constructor | Transport config only: `timeout`, `retries`, `backoff_factor`, `retry_on_status` |
| Setter methods | `set_headers()`, `set_cookies()`, `set_auth()`, `set_proxy()`, `reset_headers()`, `reset_cookies()` |
| `RequestMetrics` | Thread-safe shared collector: counters, timing, status codes, per-proxy stats, circuit breaker |
| `ExceptionDescriptor` | Structured error classification with `is_blocked()`, `is_timeout()`, `is_server_error()` |
| SOAP support | `create_soap_client(wsdl_url)`, `soap_call(method, **params)` via Zeep |

**Done when:** Unit tests for sync/async GET/POST, retry logic, metrics aggregation, mock-based.
**Depends on:** Nothing.

### WP-03: @fun_watch + AppFunctions + FunctionLog

Function-level performance monitoring decorator.

| Deliverable | Description |
|-------------|-------------|
| `AppFunctions` table | Registry with `function_hash` identity, auto-registration, caching |
| `FunctionLog` table | Per-invocation metrics: elapsed time, row counts, error state |
| `@fun_watch` decorator | Closure-local counters, per-thread FunctionLog rows, main-thread-only Apps update |

**Done when:** Decorator works standalone on any function, writes to DB, thread-safe, tests pass.
**Depends on:** Database (v0.1.0), Logging (v0.1.0).

---

## v0.3.0 — Scraping & Collection

The data collection toolkit. Provides standardized patterns for web scraping and data extraction.

### WP-04: BaseScraper + Scaffold CLI

The app framework — every scraper inherits from this.

| Deliverable | Description |
|-------------|-------------|
| Planned module path: `data_collector/scraping/base.py` | Convention-based lifecycle: `prepare_list()`, `collect()`, `store()`, `cleanup()` |
| Progress tracking | `current_count`, `total_count`, `error_count` columns on `Apps` table |
| `get_app_info(__file__)` | Convention-based `app_id` derivation from directory structure |
| Scaffold CLI | `python -m data_collector scaffold --group --parent --name --type` |
| App registration | Scaffold computes `app_id`, inserts into `Apps` table |
| Runtime arguments | `init(runtime, args=None)`, argparse CLI, JSON argument passing |

**Done when:** Can scaffold a new app and run it end-to-end against a test database.
**Depends on:** WP-01 (Enums), WP-02 (Request), Database, Logging.

### WP-05: Proxy Management

Proxy infrastructure for IP rotation and ban avoidance.

| Deliverable | Description |
|-------------|-------------|
| `data_collector/proxy/` package | `ProxyProvider` interface, `BrightDataProvider` implementation |
| `ProxyReservation` table | Atomic IP reservation via unique partial index |
| `ProxyManager` | Session rotation, proxy judges with failover, ban detection |
| Request integration | `set_proxy()` on Request class, per-proxy metrics in `RequestMetrics` |

**Done when:** Atomic reserve/release works under concurrent access, judge verification passes.
**Depends on:** WP-02 (Request), Database.

### WP-06: Captcha + Concurrency Patterns

CAPTCHA solving and multi-threaded collection patterns.

| Deliverable | Description |
|-------------|-------------|
| `data_collector/captcha/` | `AntiCaptcha` client: reCAPTCHA v2/v3, hCaptcha, image CAPTCHA |
| Concurrency patterns | `ThreadPoolExecutor` with per-thread `Request` instances |
| Shared metrics | `RequestMetrics` aggregation across all worker threads |

**Done when:** Can solve a test CAPTCHA, multi-threaded scraper template runs correctly.
**Depends on:** WP-02 (Request). WP-05 (Proxy) optional.

---

## v0.4.0 — Messaging & Orchestration

Message broker infrastructure and the central process manager.

### WP-07: Notification System

Pluggable alert channels for operational monitoring.

| Deliverable | Description |
|-------------|-------------|
| `data_collector/notifications/` | `BaseNotifier` interface with `send(severity, title, body)` |
| Implementations | Telegram, Microsoft Teams, Slack, email (SMTP), webhooks |
| Configuration | Channel selection via settings, severity filtering per channel |
| `AlertSeverity` integration | Uses enum from WP-01 |

**Done when:** Can send a test alert to at least one channel, interface is extensible.
**Depends on:** WP-01 (Enums), Logging.

### WP-08: RabbitMQ Infrastructure

Message broker for command distribution and task queue backbone.

| Deliverable | Description |
|-------------|-------------|
| Planned module path: `data_collector/messaging/rabbitmq.py` | pika-based connection management |
| Command queue topology | Exchange + queue for Manager commands (start/stop/restart/enable/disable) |
| Message format | Standardized command message schema with `CmdName`/`CmdFlag` enums |
| Reliability | Health check endpoint, automatic reconnection, connection pooling |

**Done when:** Can publish and consume command messages, connection recovery works under network failure.
**Depends on:** Nothing (pika is external). WP-01 (Enums) for message format.

### WP-09: Manager + Scheduler + Command Dispatch

The central orchestrator — schedules apps, dispatches commands, manages process lifecycle.

| Deliverable | Description |
|-------------|-------------|
| Planned module path: `data_collector/orchestration/manager.py` | Main loop polling `Apps` table |
| Scheduler | `next_run` calculation: interval-based and cron expression support |
| Command dispatch | DB polling (always available) + RabbitMQ (optional upgrade path) |
| Process lifecycle | `sys.executable` subprocess spawning, PID tracking, crash detection |
| Runtime IDs | `uuid4().hex` (32 chars) per execution |
| Graceful shutdown | Signal handling: SIGTERM, SIGINT, keyboard ESC |
| Fatal error handling | Auto-disable on repeated failures, notification alert via WP-07 |
| Log retention | Periodic cleanup of old log/runtime records |

**Done when:** Manager can schedule and run apps, handle commands from both DB and RabbitMQ, recover from crashes, send alerts on fatal errors.
**Depends on:** WP-07 (Notifications), WP-08 (RabbitMQ), WP-01 (Enums), Database, Logging.

---

## v0.5.0 — Pipeline & Integration

Asynchronous task processing, file monitoring, and specialized data source integrations.

### WP-10: Dramatiq + TaskDispatcher

Background task processing for long-running pipeline work.

| Deliverable | Description |
|-------------|-------------|
| Planned module path: `data_collector/messaging/dramatiq.py` | `DramatiqBroker` wrapping RabbitMQ connection |
| Declarative queue topology | Actor-to-queue mapping, priority queues, rate limiting |
| `TaskDispatcher` | Polls `Events` table → publishes to RabbitMQ → Dramatiq workers consume |
| `PipelineTask` table | State tracking: PENDING → RUNNING → SUCCESS/FAILED/RETRY |
| Middleware | Retry with backoff, dead-letter handling, age limits |

**Done when:** End-to-end: event row → TaskDispatcher → RabbitMQ → Dramatiq worker → completion with state tracking.
**Depends on:** WP-08 (RabbitMQ), Database.

### WP-11: WatchService

File system monitoring that produces events for pipeline processing.

| Deliverable | Description |
|-------------|-------------|
| Planned module path: `data_collector/messaging/watchservice.py` | watchdog-based file system observer |
| Event production | Writes to `Events` table (not directly to Dramatiq) |
| Platform support | `ReadDirectoryChangesW` (Windows), `inotify` (Linux), `FSEvents` (macOS) |
| Stability | Debounce for rapid file changes, duplicate detection |

**Done when:** File drop triggers event row, TaskDispatcher picks it up and dispatches to Dramatiq.
**Depends on:** WP-10 (TaskDispatcher), Database.

### WP-12: SOAP/XML + PDF/OCR + Storage + Data Quality

Specialized data source integrations and file management.

| Deliverable | Description |
|-------------|-------------|
| SOAP/XML | Zeep wrapper via Request class `create_soap_client()`, `soap_call()`, namespace handling |
| PDF processing | pdfplumber text extraction, table extraction, `classify_pdf()` |
| OCR engine | pytesseract + PaddleOCR adapter pattern, image preprocessing pipeline |
| Storage | Directory organization, file naming conventions, retention policies |
| Data quality | Validation rules, change auditing, quality metrics via `merge()` |

**Done when:** Can process a SOAP call, extract PDF text, OCR an image, organize stored files.
**Depends on:** WP-02 (Request, for SOAP), Database. Can be started in parallel with WP-10/WP-11.

---

## v0.6.0 — Advanced Features

### WP-13: NER Pipeline

Named Entity Recognition for extracting structured data from unstructured text.

| Deliverable | Description |
|-------------|-------------|
| `BaseNERWorker` | Dramatiq actor base class for NER processing |
| Model integration | spaCy (rule-based + statistical), GLiNER (zero-shot), transformers (fine-tuned) |
| Entity extraction | From OCR text and scraped HTML, stored in normalized entity tables |
| Custom training | Fine-tuning utilities for domain-specific annotated data (optional) |

**Done when:** Can extract entities from PDF text via Dramatiq pipeline end-to-end.
**Depends on:** WP-10 (Dramatiq), WP-12 (PDF/OCR).

---

## v1.0.0 — Platform Release

Transform from framework to platform.

### WP-14: REST API + Authentication

Management API for operational control.

| Deliverable | Description |
|-------------|-------------|
| FastAPI server | App CRUD, command dispatch, status queries, log retrieval |
| WebSocket streaming | Real-time log and progress streaming |
| OAuth2 + JWT | PyJWT-based authentication with role-based access control |
| Client Credentials | Service-to-service auth for Copilot, bots, external integrations |

**Done when:** Can manage apps via API, stream logs in real time, authenticate users and services.
**Depends on:** WP-09 (Manager), Database.

### WP-15: Dashboard + Security + Docker

Operational visibility, security hardening, and containerized deployment.

| Deliverable | Description |
|-------------|-------------|
| Dashboard | Dash (Plotly) mounted inside FastAPI as WSGI middleware |
| Security hardening | CORS lockdown, token revocation, refresh rotation, rate limiting (slowapi), security headers, audit logging |
| Docker packaging | Planned file path: `docker-compose.yml` + `Dockerfile` for Manager + Dramatiq workers + database |
| Documentation site | MkDocs or Sphinx-generated documentation website (optional) |

**Done when:** Dashboard shows live app status, Docker deployment works end-to-end, security audit passes.
**Depends on:** WP-14 (REST API), WP-10 (Dramatiq).

---

## Airflow Integration (Optional)

**Not a numbered work package.** For clients with existing Apache Airflow infrastructure, a `DataCollectorOperator` can be built at any point after WP-09 (Manager). Apps are orchestration-agnostic — the same code runs under Manager or Airflow without modification. Planned module path: `data_collector/orchestration/airflow.py`.

---

## Guiding Principles

1. **No forward dependencies.** Every work package depends only on completed work packages. No circular references.
2. **One thing at a time.** WIP limit of 1 in "In Progress" prevents context switching and half-finished features.
3. **Core framework is stable before extensions.** No refactoring the Database class while building scrapers.
4. **Documentation accompanies code.** Feature docs are updated as part of every work package, not as a separate phase.
5. **Tests accompany every feature.** No work package is "Done" without passing unit tests.
6. **Backward compatibility within major versions.** Apps built on v0.1.0 must work on v0.6.0 without changes.
7. **Work packages can be split.** If a WP grows beyond expected scope, split it rather than delivering a half-finished package.
