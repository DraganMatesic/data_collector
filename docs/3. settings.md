[← Back to index](1.%20index.md)
# Settings package
Contains various modules that are used by framework, app or group of apps. 
Variables values are stored in user environment variables, 
but it can be stored also in system variables when cross user availability is needed.
It separates shared environment configuration from country-specific customization.
This way all sensitive data is secured and code can be safely stored on repository.

## Content
- [DatabaseSettings class](#databasesettings-class)
  - [PostgreSQL settings](#postgresql-settings)
    - [SQL login](#postgresql-sql-login)
    - [Windows Authentication](#postgresql-win-auth)
        - [GSSAPI](#postgresql-gssapi)
    - [Kerberos](#postgresql-kerberos)
  - [Microsoft SQL Server Settings](#mssql-settings)
    - [SQL login](#mssql-sql-login)
    - [Windows Authentication](#mssql-win-auth)


## main.py
This module is storing setting mandatory for the framework and applications to work

### DatabaseSettings class
This is parent class that every Database settings class should inherit.
In this class you can see all possible settings that can be done with database.
Currently supporting PostgreSQL (psycopg2) and MSSQL (pyodbc) databases.
Additional databases can be added by implementing the `BaseDBConnector` interface.

When creating Database settings that inherit DatabaseSettings class it is necessary
to update variables inherited from DatabaseSettings depending on what of 
authentication methods you plan to use and what Database type. 


### PostgreSQL Settings 
Supported authentication methods:
- SQL login (username, password)
- Windows Authentication
- Kerberos

##### SQL login <a id="postgresql-sql-login"></a>
Mandatory variables to update are:
- username
- password
- database_name
- database_type = DatabaseType.POSTGRES
- database_driver = DatabaseDriver.POSTGRES
- **To define the host**, choose one of variables:
  - ip and port
  - or server_name

```python
class ExampleDatabaseSettings(DatabaseSettings):
    username: str = Field(..., alias="DC_DB_MAIN_USERNAME")
    password: str = Field(..., alias="DC_DB_MAIN_PASSWORD")
    database_name: str = Field(..., alias="DC_DB_MAIN_DATABASENAME")
    database_type: DatabaseType = DatabaseType.POSTGRES
    database_driver: DatabaseDriver = DatabaseDriver.POSTGRES
    ip: Optional[str] = Field(..., alias="DC_DB_MAIN_IP")
    port: Optional[int] = Field(..., alias="DC_DB_MAIN_PORT")
    server_name: Optional[str] = Field(None, alias="DC_DB_MAIN_SERVERNAME")
```

##### Windows Authentication <a id="postgresql-win-auth"></a>
Mandatory variables to update are:
- database_name
- database_type = DatabaseType.POSTGRES
- database_driver = DatabaseDriver.POSTGRES
- auth_type = AuthMethods.WINDOWS
- **To define the host**, choose one of variables:
  - ip and port
  - or server_name
- **Optional**:
  - gssapi — controls GSSAPI encryption behavior (default is GssApiEnc.PREFER)

```python
class ExampleDatabaseSettings(DatabaseSettings):
    database_name: str = Field(..., alias="DC_DB_MAIN_DATABASENAME")
    database_type: DatabaseType = DatabaseType.POSTGRES
    database_driver: DatabaseDriver = DatabaseDriver.POSTGRES
    auth_type = AuthMethods.WINDOWS
    ip: Optional[str] = Field(..., alias="DC_DB_MAIN_IP")
    port: Optional[int] = Field(..., alias="DC_DB_MAIN_PORT")
    server_name: Optional[str] = Field(None, alias="DC_DB_MAIN_SERVERNAME")
    gssapi: GssApiEnc = GssApiEnc.PREFER
```

#### GSSAPI (Windows authentication option) <a id="postgresql-gssapi"></a>
GSSAPI means Whether the connection is encrypted using GSSAPI-level encryption (separate from SSL)

| Value             | Behavior                                                 |
|-------------------|----------------------------------------------------------|
| GssApiEnc.DISABLE | Don't use GSS encryption, even if available              |
| GssApiEnc.PREFER  | Use GSS encryption if the server supports it (default) |
| GssApiEnc.REQUIRE | Fail the connection if GSS encryption cannot be used     |


#### Kerberos <a id="postgresql-kerberos"></a>
Mandatory variables to update are:
- database_name
- auth_type = AuthMethods.KERBEROS
- **To define the host**, choose one of variables:
  - ip and port
  - or server_name
- **Optional**:
  - username (if not defined it will use current system user)
  - principal_name (if kerberos service principal name is not defined it will use 'postgres' by default)

```python
class ExampleDatabaseSettings(DatabaseSettings):
    database_name: str = Field(..., alias="DC_DB_MAIN_DATABASENAME")
    auth_type = AuthMethods.KERBEROS
    ip: Optional[str] = Field(..., alias="DC_DB_MAIN_IP")
    port: Optional[int] = Field(..., alias="DC_DB_MAIN_PORT")
    server_name: Optional[str] = Field(None, alias="DC_DB_MAIN_SERVERNAME")
    username: str = Field(..., alias="DC_DB_MAIN_USERNAME")
    principal_name: str = 'postgres'
```

### Microsoft SQL Server Settings <a id="mssql-settings"></a>
Supported autentification methods:
- SQL login (username, password)
- Windows Authentication

##### SQL login <a id="mssql-sql-login"></a>
Mandatory variables to update are:
- username
- password
- database_name
- database_type = DatabaseType.MSSQL
- database_driver = DatabaseDriver.ODBC
- **To define the host**, choose one of variables:
  - ip and port
  - or server_name
- **Optional**:
  - odbc_driver (if ODBC driver is not defined it will use 'ODBC+Driver+17+for+SQL+Server' by default)

```python
class ExampleDatabaseSettings(DatabaseSettings):
    username: str = Field(..., alias="DC_DB_MAIN_USERNAME")
    password: str = Field(..., alias="DC_DB_MAIN_PASSWORD")
    database_name: str = Field(..., alias="DC_DB_MAIN_DATABASENAME")
    database_type: DatabaseType = DatabaseType.MSSQL
    database_driver: DatabaseDriver = DatabaseDriver.ODBC
    ip: Optional[str] = Field(..., alias="DC_DB_MAIN_IP")
    port: Optional[int] = Field(..., alias="DC_DB_MAIN_PORT")
    server_name: Optional[str] = Field(None, alias="DC_DB_MAIN_SERVERNAME")
```

##### Windows Authentication <a id="mssql-win-auth"></a>
Mandatory variables to update are:
- database_name
- database_type = DatabaseType.MSSQL
- database_driver = DatabaseDriver.ODBC
- auth_type = AuthMethods.WINDOWS
- **To define the host**, choose one of variables:
  - ip and port
  - or server_name
- **Optional**:
  - odbc_driver (if ODBC driver is not defined it will use 'ODBC+Driver+17+for+SQL+Server' by default)

```python
class ExampleDatabaseSettings(DatabaseSettings):
    database_name: str = Field(..., alias="DC_DB_MAIN_DATABASENAME")
    database_type: DatabaseType = DatabaseType.MSSQL
    database_driver: DatabaseDriver = DatabaseDriver.ODBC
    ip: Optional[str] = Field(..., alias="DC_DB_MAIN_IP")
    port: Optional[int] = Field(..., alias="DC_DB_MAIN_PORT")
    server_name: Optional[str] = Field(None, alias="DC_DB_MAIN_SERVERNAME")
```

---

## MainDatabaseSettings <a id="main-database-settings"></a>

Pre-configured settings class for the database where Data Collector deploys its own schema (apps, logs, runtime tables).

```python
from data_collector.settings.main import MainDatabaseSettings

settings = MainDatabaseSettings()
```

All fields load from environment variables with the `DC_DB_MAIN_` prefix:

| Field | Env Variable | Required | Default |
|-------|-------------|----------|---------|
| `username` | `DC_DB_MAIN_USERNAME` | Yes | — |
| `password` | `DC_DB_MAIN_PASSWORD` | Yes | — |
| `database_name` | `DC_DB_MAIN_DATABASENAME` | Yes | — |
| `ip` | `DC_DB_MAIN_IP` | Yes | — |
| `port` | `DC_DB_MAIN_PORT` | Yes | — |
| `server_name` | `DC_DB_MAIN_SERVERNAME` | No | None |
| `database_type` | — | No | `DatabaseType.POSTGRES` |
| `database_driver` | — | No | `DatabaseDriver.POSTGRES` |
| `map_objects` | — | No | `True` |

## LogSettings <a id="log-settings"></a>

Configuration for the logging system. See [5. logging.md](5.%20logging.md) for full usage.

```python
from data_collector.settings.main import LogSettings

settings = LogSettings()
```

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `log_to_db` | bool | `True` | Enable database logging |
| `log_to_splunk` | bool | `False` | Enable Splunk HEC logging |
| `splunk_hec_url` | str \| None | `None` | Splunk HEC endpoint URL |
| `splunk_token` | str \| None | `None` | Splunk HEC authentication token |
| `log_max_queue` | int | `10000` | Maximum queue size before blocking |
| `log_format` | `Literal["console", "json"]` | `"console"` | Console: colored key=value (dev). JSON: machine-readable (prod) |
| `log_level` | int | `10` | Minimum log level (10=DEBUG, 20=INFO, 30=WARNING, 40=ERROR, 50=CRITICAL) |
| `log_call_chain` | bool | `True` | Enable call_chain extraction via stack introspection |
| `log_context_max_keys` | int | `50` | Maximum arbitrary context keys per log event |
| `log_error_file` | str | `"error.log"` | Path for sink failure fallback log |
| `log_error_max_bytes` | int | `5242880` | Max file size before rotation (5 MB) |
| `log_error_backup_count` | int | `3` | Number of rotated backup files to keep |

## GeneralSettings <a id="general-settings"></a>

Composite settings class used when multiple setting types are needed together.

```python
from data_collector.settings.main import GeneralSettings

settings = GeneralSettings()
# settings.db_main  → MainDatabaseSettings instance
# settings.log_settings → LogSettings instance
```

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `db_main` | MainDatabaseSettings | `MainDatabaseSettings()` | Framework database connection |
| `log_settings` | LogSettings | `LogSettings()` | Logging configuration |

## Creating Custom Settings Classes <a id="custom-settings"></a>

For connecting to additional databases (data warehouse, client DB, etc.), inherit from `DatabaseSettings`:

```python
from pydantic import Field
from typing import Optional
from data_collector.settings.main import DatabaseSettings, DatabaseType, DatabaseDriver

class WarehouseSettings(DatabaseSettings):
    """Settings for the data warehouse database"""
    username: str = Field(..., alias="DC_DB_WAREHOUSE_USERNAME")
    password: str = Field(..., alias="DC_DB_WAREHOUSE_PASSWORD")
    database_name: str = Field(..., alias="DC_DB_WAREHOUSE_DATABASENAME")
    ip: Optional[str] = Field(..., alias="DC_DB_WAREHOUSE_IP")
    port: Optional[int] = Field(..., alias="DC_DB_WAREHOUSE_PORT")
    database_type: DatabaseType = DatabaseType.MSSQL
    database_driver: DatabaseDriver = DatabaseDriver.ODBC
```

Then use it with `Database`:

```python
from data_collector.utilities.database.main import Database

warehouse_db = Database(WarehouseSettings())
```

## Environment Variable Reference <a id="env-reference"></a>

Complete list of all environment variables used by the framework:

| Variable | Used By | Required | Description |
|----------|---------|----------|-------------|
| `DC_DB_MAIN_USERNAME` | MainDatabaseSettings | Yes | Framework DB username |
| `DC_DB_MAIN_PASSWORD` | MainDatabaseSettings | Yes | Framework DB password |
| `DC_DB_MAIN_DATABASENAME` | MainDatabaseSettings | Yes | Framework DB name |
| `DC_DB_MAIN_IP` | MainDatabaseSettings | Yes | Framework DB IP address |
| `DC_DB_MAIN_PORT` | MainDatabaseSettings | Yes | Framework DB port |
| `DC_DB_MAIN_SERVERNAME` | MainDatabaseSettings | No | Framework DB server name (alternative to IP:port) |
| `DC_SECRET_PASSWORD` | SecretLoader | No | Password for decrypting secrets.env.enc |

## NotificationSettings (in development) <a id="notification-settings"></a>

The framework provides a pluggable notification system supporting multiple channels:

| Channel | Status | Description |
|---------|--------|-------------|
| Telegram | Available | Bot-based notifications via Telegram API |
| Microsoft Teams | Available | Webhook-based notifications |
| Slack | Available | Webhook-based notifications |
| Email | Available | SMTP-based notifications |
| Webhooks | Available | Generic HTTP webhook notifications |

Each channel is configured independently. The notification system uses the same pluggable pattern as `BaseDBConnector` — new channels can be added by implementing the base notification interface.

## RequestSettings (in development) <a id="request-settings"></a>

Centralized configuration for the `Request` class used across all HTTP-based data collection:

| Setting | Type | Default | Description |
|---------|------|---------|-------------|
| `retry_count` | int | `3` | Number of retry attempts on failure |
| `retry_backoff` | float | `1.0` | Backoff multiplier between retries |
| `timeout` | int | `30` | Default request timeout in seconds |
| `proxy` | str \| None | `None` | Proxy URL for outbound requests |

## ProxySettings (in development) <a id="proxy-settings"></a>

Configuration for the proxy management system — IP verification, reservation, and TTL. See [15. proxy.md](15.%20proxy.md).

| Setting | Type | Default | Description |
|---------|------|---------|-------------|
| `proxy_judges` | list[str] | `["httpbin.org/ip", "api.ipify.org", "ifconfig.me/ip"]` | Judge URLs for IP verification (tried in order with failover) |
| `proxy_ttl_seconds` | int | `1800` | Reservation TTL in seconds (30 min default). Expired reservations are ignored during acquisition |
| `proxy_acquire_timeout` | int | `120` | Max seconds to wait when acquiring a unique proxy |
| `proxy_recheck_interval` | int | `5` | Seconds between retries when an IP is already reserved |
| `proxy_max_judge_failures` | int | `3` | Consecutive judge failures before triggering fatal |