[← Back to index](1.%20index.md)

# Storage Management

**Implementation Status:** In Development | **Phase:** 4 (v0.4.0)

## Overview

File and blob storage management for downloaded documents, images, PDFs, and extracted data. Provides consistent directory organization, retention policies, and deduplication. Developed and tested primarily on Windows, but fully deployable on Linux.

## Storage Backends

| Backend | Use Case | Status |
|---------|----------|--------|
| Local filesystem | Development, single-server | In development |
| Network shares | Multi-server, shared storage | In development |
| Cloud storage (S3, GCS) | Scalable, managed | Planned |

## File Organization

### Directory Structure Convention

All paths use `pathlib.Path` for cross-platform compatibility (Windows + Linux):

```
storage_root/
├── {group}/
│   └── {parent}/
│       └── {app_name}/
│           └── {YYYY-MM-DD}/
│               ├── document_001.pdf
│               ├── document_002.pdf
│               └── metadata.json
```

**Examples:**
- Windows: `C:\data_collector\storage\scrapers\registry\company_scraper\2025-01-15\`
- Linux: `/opt/data_collector/storage/scrapers/registry/company_scraper/2025-01-15/`

### File Naming Patterns
- `{source_id}_{timestamp}.{ext}` — unique per download
- Hash-based naming for deduplication: `{sha256_of_content}.{ext}`

## Retention Policies

| Policy | Description |
|--------|-------------|
| Keep all | Never delete (regulatory compliance) |
| Time-based | Delete after N days |
| Count-based | Keep last N versions per entity |
| Size-based | Delete oldest when storage exceeds limit |

## Integration

- Link stored files to database records via file path or hash
- Track download status in `Runtime` table
- Deduplication: skip download if content hash already exists

## Configuration

| Setting | Default | Description |
|---------|---------|-------------|
| `storage_root` | `./storage` | Base directory for file storage (use `pathlib.Path` for cross-platform) |
| `retention_days` | `365` | Default retention period |
| `max_storage_gb` | `100` | Alert threshold for storage usage |

## Dependencies

- Python standard library: `pathlib`, `shutil`, `zipfile`
